<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Plataforma de procesos (local)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { margin:0; font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; background:#f3f4f6; }
      :root { --radius:18px; }
      #pin{height:100vh;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle,#d72626,#410000 70%);}
      #pin .box{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);padding:26px 20px 20px;border-radius:16px;color:#fff;text-align:center;width:280px}
      #pin input{width:100%;padding:6px 4px;margin-top:10px;border-radius:6px;border:1px solid rgba(255,255,255,.2);background:rgba(0,0,0,.2);color:#fff;text-align:center;letter-spacing:.3em}
      #pin button{margin-top:12px;width:100%;padding:7px 0;border:none;background:#d72626;color:#fff;border-radius:6px;cursor:pointer}
      #app{display:none;height:100vh;flex-direction:column}
      .top{display:flex;gap:8px;align-items:center;background:linear-gradient(90deg,#000,#5a0000);color:#fff;padding:10px}
      .top h1{margin:0;font-size:20px;font-weight:700}
      .top input{flex:1;max-width:430px;border:none;background:rgba(255,255,255,.12);padding:5px 10px;border-radius:999px;color:#fff}
      .main{flex:1;display:flex;gap:10px;padding:10px}
      .panel{background:#fff;border-radius:var(--radius);box-shadow:0 4px 14px rgba(0,0,0,.04);display:flex;flex-direction:column;overflow:hidden}
      .panel header{padding:9px 12px;background:#000;color:#fff;display:flex;align-items:center;justify-content:space-between}
      .panel-title{font-weight:600}
      #proc{width:290px}
      .panel .body{flex:1;overflow:auto;padding:8px}
      .proc-item{background:#fff;border:2px solid transparent;border-radius:14px;margin-bottom:6px;padding:4px 6px 4px 8px;display:flex;gap:4px;align-items:flex-start;cursor:pointer}
      .proc-item.active{box-shadow:inset 0 0 0 2px rgba(0,0,0,.05);}
      .proc-input{border:none;background:transparent;font-weight:600;font-size:13px;width:100%;outline:none}
      .proc-num{font-size:11px;font-weight:700;margin-right:4px;color:#000;}
      .proc-desc{margin-top:4px;font-size:11px}
      .proc-desc textarea{width:100%;min-height:45px;border:1px solid rgba(0,0,0,.08);border-radius:8px;padding:3px 4px;font-size:11px;background:#fff}
      .proc-desc-toggle{font-size:10px;background:rgba(0,0,0,.05);border:none;border-radius:12px;padding:1px 6px;cursor:pointer}
      .btn{background:rgba(188,0,0,.1);border:none;border-radius:999px;padding:3px 9px;color:#bc0000;cursor:pointer}
      .btn-small{padding:2px 7px;font-size:11px}
      #sub{flex:1}
      .sub-box{border:1px solid rgba(0,0,0,.03);border-radius:14px;padding:6px 7px;margin-bottom:6px;background:#fff}
      .sub-box.active{outline:2px solid rgba(0,0,0,.04)}
      .label{font-size:10px;text-transform:uppercase;color:#777;margin-top:3px}
      .input{width:100%;border:1px solid #eee;border-radius:6px;padding:3px 5px;font-size:12px}
      textarea.input{min-height:40px;resize:vertical}
      .sub-header-inline{display:flex;gap:4px;align-items:center;justify-content:space-between}
      .sub-actions{display:flex;gap:4px}
      .sub-steps-btn{background:rgba(0,0,0,.05);border:none;border-radius:8px;padding:2px 8px;font-size:11px;cursor:pointer}
      .sub-steps-btn.active{background:#000;color:#fff}
      #steps{width:320px;transition:all .2s ease}
      #steps.hidden{width:0;min-width:0;opacity:0;pointer-events:none}
      .step{border:1px solid #eee;border-radius:14px;padding:5px 7px;margin-bottom:6px;background:#fff}
      .step .input{font-size:12px}
      .step-num{font-weight:700;font-size:11px;margin-bottom:4px}
      .origin{font-size:11px;color:#555;margin-bottom:5px;font-weight:500}
    </style>
  </head>
  <body>
    <div id="pin">
      <div class="box">
        <h2>PROCESOS</h2>
        <p style="opacity:.7;font-size:12px">Introduce tu PIN</p>
        <input id="pinInput" type="password" placeholder="AR4321" />
        <button onclick="checkPin()">Entrar</button>
        <p id="pinErr" style="color:#ffe0e0;font-size:11px"></p>
      </div>
    </div>

    <div id="app">
      <div class="top">
        <h1>PROCESOS</h1>
        <input id="search" placeholder="Buscar..." oninput="doSearch(this.value)" />
        <button class="btn" onclick="alert('Guardado en localStorage âœ…')">ðŸ’¾ Guardar</button>
      </div>
      <div class="main">
        <div class="panel" id="proc">
          <header>
            <span class="panel-title">Procesos</span>
            <div style="display:flex;gap:6px">
              <button class="btn-small btn" onclick="addProcess()">+ Proceso</button>
              <button class="btn-small btn" onclick="quickAddSub()">+ Subp.</button>
              <button class="btn-small btn" onclick="quickAddStep()">+ Paso</button>
            </div>
          </header>
          <div class="body" id="procList"></div>
        </div>
        <div class="panel" id="sub">
          <header id="subHeader">
            <span class="panel-title">Subproceso</span>
            <button class="btn" onclick="addSub()">+ Subproceso</button>
          </header>
          <div class="body" id="subList"></div>
        </div>
        <div class="panel" id="steps">
          <header id="stepHeader">
            <span class="panel-title">Pasos</span>
            <button class="btn" onclick="addStep()">+ Pas
